## snowball fight
[GitHub 링크](https://github.com/decentraland-scenes/snowball-fight)


### 어떤 게임인지, 주요 기능 설명 (1~2문단)
실시간 멀티플레이 눈싸움 게임으로, red/blue 팀을 선택한 후 눈덩이를 던져 상대 팀 플레이어를 맞히면 팀 점수가 올라가는 시스템이다. 일정 시간 동안 더 높은 점수를 획득한 팀이 승리하며 게임 종료 후 MVP를 발표한다.


### 클라이언트와 서버 구조 요약 (간단한 도식 가능)
클라이언트: 팀 선택, 눈덩이 던지기, 플레이어 이동, 적 위치/점수/게임 경과시간 등 정보 수신
서버(Colyseus Room): 플레이어 행동 정보 수신(눈덩이 던지기 등), 눈덩이 맞혔는지 유효 판정, 점수 업데이트, 게임 경과시간 관리, 발생한 이벤트 모든 플레이어에게 전달 (+결과를 Firebase에 저장) 


### Colyseus가 사용된 부분 요약
    - 룸(Room) 관리: 
        MyRoom.ts에서 Room<MyRoomState> 클래스를 상속해 게임 방을 정의함
        onJoin, onLeave, onCreate, onDispose 메서드를 통해 플레이어 입장/퇴장, 방 생성/삭제 관리 
        같은 realm에 있는 플레이어끼리는 같은 Room에 자동 매칭됨
    - 상태 동기화(State Synchronization)
        MyRoomState를 통해 서버가 관리하는 상태(점수, 플레이어 정보, 시간 등)를 정의함
        서버 상태 변경 사항(점수, 경기 시작/종료 등) --> 자동으로 클라이언트와 동기화됨!
        클라이언트는 직접 서버 상태 관리x, Colyseus가 전달하는 메시지 통해서 최신 상태 유지 
    - 메시지 처리(Message Handling)
        onMessage() 메서드를 통해 클라이언트가 보낸 행동을 서버에서 처리


### 우리가 수업에서 배운 개념과 연결되는 부분
**서버-클라이언트 구조**: 클라이언트가 눈덩이 던지기, 팀 선택 등의 입력을 하고, 서버는 그 입력을 받아 계산 결과를 모든 클라이언트에 broadcast --> 실시간 동기화가 가능해짐
**Room, State**: 
MyRoom.ts --> Room 클래스. 플레이어 입장/퇴장, 게임 로직 처리
MyRoomState.ts --> State 클래스. 점수, 플레이어 목록 등 Room의 State 처리


### 개인 소감 & 회고
    - 이 프로젝트에서 특히 흥미롭거나 배운 점
      이때까지는 코드의 부분부분만 뜯어보다가, 실제로 구동되는 오픈소스 게임의 폴더 구조와 전체 코드 흐름을 살펴볼 수 있어서 좋았다. 코드 외에도 이펙트나 모델링? 같은 그래픽 요소들은 파일이 어떻게 구성되는지 궁금했었는데 그 부분까지 직접 볼 수 있어 흥미로웠다.
    - Colyseus 또는 TypeScript를 활용한 서버 개발에 대한 느낌
      멀티플레이어 게임 제작의 개념을 새롭게 접할 수 있어서 흥미로웠다. 대체 어떻게 여러 디바이스의 동작이 실시간으로 반영되는 것인지에 대한 궁금증이 조금은 풀렸다.
      다만 콜리세우스를 활용해서 실제로 게임을 어떻게 만드는지는 아직 감이 잘 안 와서 아쉽다. 아무래도 프레임워크를 가볍게 다뤄보는 찍먹 목적의 스터디다 보니 그럴 수밖에 없는 것 같다. 나중에 게임 서버 공부를 좀 더 하고, 다른 프로젝트로 게임 제작 과정을 한 번 겪어 보면 이걸 어떻게 활용해야 할지 감이 잡히지 않을까 생각이 든다. 이번에 제대로 실습을 못 돌려 본 5주차 코드도 그때 다시 만져보고 싶다!
      공부할 키워드를 많이 알게 된 스터디였다ㅎㅎ. 좋은 스터디 기획하고 끝까지 잘 이끌어 주신 윤아언니 무한 감사합니다 넘 수고하셨습니다~~!!!









// 코드분석

**scene-blue/src/connection.ts**
colyeseus 서버에 연결
룸 생성 --> 같은 realm에 속한 플레이어끼리 같은 룸에 모이게 함
(+연결 관련 기본 기능: 
테스트모드 실서버 구분해서 서버 연결, 연결상태 메시지, 기존 연결 상태 확인)
=> 서버랑 통신하는 코드 

**scene-blue/src/game.ts**
언제 connect()함수 호출할지 관리 (서버 연결 타이밍)
Colyseus 서버 연결 관리 + realm 이동 시 다시 연결

cf. realm: 같은 서버 구역에 있는 플레이어끼리 같은 룸에 넣는 용도

**scene-blue/src/onConnect.ts**
서버 연결되면 내 플레이어 매니저 초기화
다른 플레이어 접속 여부 관리
서버에서 보내는 메시지 처리
주기적으로 플레이어 상태 체크
=> 서버 연결 후, 게임 상태 동기화 및 이벤트 처리 (메인 로직인 듯)

**scene-blue/src/cones.ts**
팀 색깔 결정하는 콘 생성

cf. 씬: 하나의 Parcel(서버의 부분적 공간?)에 배치된 독립적 코드 

**scene-blue/src/MyRoom.ts**
서버에서 눈싸움 방 생성
팀 나누기
공 던지기/맞히기 처리
점수 및 경기 타이머 관리
경기 결과 Firebase에 저장

MyRoom 클래스: 경기/로비 시간 설정, 현재까지 경과 시간 저장

OnCreate():
- 방이 처음 만들어질 때 실행됨 --> 방 상태 초기화
- this.onMessage()를 이용해 클라이언트가 보내는 메시지를 어떻게 처리할지 정의
pickColor 팀 선택
throwBall 눈덩이 던짐(다른 플레이어한테 눈덩이가 날아가는 이벤트 전달)
enemyHit 적 맞혔다고 알림(이후 점수 계산 및 MVP 체크) 
getUserColor 특정 적의 팀 색 반환 
startMatch/endMatch 경기 시작/종료 처리 
score 실시간 점수 업데이트
bestPlayer MVP 클라이언트에 전달 

update():
1초마다 실행 반복
- 경기 중이면 남은 시간 계속 브로드캐스트하기
- 경기가 끄타면 점수 비교 후 승패 결정 --> 클라이언트에 알리기
- 로비 중이면 로비 타이머 돌리기, 타이머 끝나면 경기 시작

onJoin():
플레이어가 입장하면 실행됨
- 새 플레이어 객체 생성
- 팀 배정
- 기존 플레이어 목록을 새 유저에게 전송
- 점수와 경기 상태 동기화

onLeave(): 나간 플레이어 제거

saveScores(): 점수 저장

onDispose(): 방 사라질 때 실행됨 
